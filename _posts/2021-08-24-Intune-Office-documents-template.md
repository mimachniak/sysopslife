---
title: "Intune (Endpoint Manager) - How to deploy Office templates and keep them up to date (recurring)."
classes: wide
excerpt: "Intune (Endpoint Manager) - How to deploy Office templates and keep them up to date. Office template used in organization are mote common and easy task to be deployed over GPO, most of organization have own templates with logos, formats etc. Templates are often store on some file share from where computer / user can download them, so storage is some of barriers when we like to use full cloud MDM in form of SaaS."
toc: true
header:
  image: /assets/images/
  teaser: /assets/images/teaser/Intune-Office-Template.png
categories:
  - SysOps
  - Office
  - PowerShell
tags:
  - Intune
  - MDM
  - Office
  - Automation
  - Azure
published: true
hidden: false
---

## Why I write this article

Deploy office template used in organization are common and easy task to be deployed over GPO, most of organization have own templates with logos, formats etc. Templates are often store on some file share from where computer / user can download them, so storage is some of barriers when we like to use full cloud MDM in form of SaaS.  
Another limitation is that Intune don't have ability to tun PowerShell script in some schedule. 
On this article I will show how to do it with full cloud based solution, for this I will use Azure and Intune.

## Prerequisites 

On this article we will use: 
* Azure storage account
* Intune (Endpoint Manager)
* PowerShell scripts

## General flow and execution

Templates will be refreshed each time user log on to PC

![](/assets/images/Office-template-mechanimz.png)

## Azure subscription creation

First we will need to create free Azure Subscription:


Link : [Create Free Azure account](https://azure.microsoft.com/en-us/free/)
Guide:
<iframe width="560" height="315" src="https://www.youtube.com/embed/0KEfaUfolVs" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>  
  

## Azure storage account configuration

To storge office templete and script responsible for deploying templates in local machine, we will use azure storage account with **public blob container**. Storage account is one of chepes solution to keep data and expensive are based on amount of data counted in GB per month.

### Create stroage account in Azure

1. Logon to [https://portal.azure.com ](https://portal.azure.com)
2. On top search bar type **storage account**

![](/assets/images/Azure/azure-st-1.PNG)

3. On navigation bar click **Create**

![](/assets/images/Azure/azure-st-2.PNG)

4. Enter data in **Basic** tab

![](/assets/images/Azure/azure-st-3.PNG)

5. On **Advanced** tab click **Next**
6. On **Networking** tab click **Next**
7. On **Data protection** tab click **Next**
8. On **Tags** tab click **Next**
8. On **Review + Create** tab click **Create** if Validation passed

![](/assets/images/Azure/azure-st-4.PNG)

### Create public blob on storage account

1. Logon to [https://portal.azure.com ](https://portal.azure.com)
2. On top search bar type **storage account**
3. Click on storage account created previously
4. On left navigation menu click on **Containers**

![](/assets/images/Azure/azure-st-5.PNG)

5. On navigation bar click **Container**

![](/assets/images/Azure/azure-st-6.PNG)

6. Enter date for new container and chage public access level then click **Create**

![](/assets/images/Azure/azure-st-7.PNG)

7. Click on created container with name **office-template**
8. Upload office template files by clicking **Upload** on navigation menu
9. Click on created container with name **scripts**

## PowerShell scripts data preparation

Powershell scripts can be found on my repository under this link: [https://github.com/mimachniak/sysopslife-scripts/Intune](https://github.com/mimachniak/sysopslife-scripts/Intune)

### Prepare script that will download Office template file to dedicated folder

#### Script responsible for downloading templates to local environment
1. Change parameter date dedicated for your environment, script can be downloaded form GitHub: [Intune-DocumentTemplateStorageAccount.ps1](https://github.com/mimachniak/sysopslife-scripts/blob/master/Intune/Intune-DocumentTemplateStorageAccount.ps1)

```powershell

$LogLocation = 'C:\Users\Public\Documents\' # Location of lgs generated by execution of the script
$LogFileName = 'OfficeTemplates.log' # log file name


Start-Transcript -Path  $LogLocation$LogFileName # Create log each run script

$storageAccountName = "dofficetemplate.blob.core.windows.net" # Azure Storage Acccount Url
$containerName = "office-template" # Azure storage account blob container with files
$TemplateFolderName = 'Office Templates' # Folder name on desktop when files willbe downloaded

```

2. Storage account **Name** is available in **Endpoints** section in Azure on **Blob**
3. Upload script to **Container** on storage account, the same **container** name **scripts**
4. Click on uploade script with name **Intune-DocumentTemplateStorageAccount.ps1**
5. Copy **URL** and past it to second script that will be deploy by **Intune**

#### Script responsible creating by Intune task schduler that will execute script each time user log in to desktop.

1. Change parameter date dedicated for your environment, script can be downloaded form GitHub: [Windows10-taskScheduler-register-executescript-url.ps1](https://github.com/mimachniak/sysopslife-scripts/blob/master/Intune/Windows10-taskScheduler-register-executescript-url.ps1)

```powershell

$LogLocation = 'C:\Users\Public\Documents\' # Location of lgs generated by execution of the script
$LogFileName = 'IntunePowerShell.log' # log file name

$storageAccountNameScriptUrl = 'https://dofficetemplate.blob.core.windows.net/scripts/Intune-DocumentTemplateStorageAccount.ps1' # Azure Storage Acccount Url to script

```
2. Logon to https://endpoint.microsoft.com
3. In Endpoint Manager Console navigate to **Devices --> Windows --> PowerShell scripts**
4. On navigation click **Add**
5. Enter **Name** and **Description**
6. On **Script Settings** add script and select **Run this script using the logged on credentials**

>
> The script runs with the usersâ€™ credentials on the client computer. By default, the script runs in system context.
>

7. On **Assignments** and ***All Users** or selected group of **Users**
8. Click **Next** and **Add**

## Windows 10 verification

### Intune policy synchronization force

1. Log on to device 
2. Navigate to **Settings --> Accounts --> Access work or school**
3. Click on connection and then on **Info**
4. Scroll down and click on **Sync**
5. After sync completed (can take to 30 min) go to **task scheduler**
6. Verify that task was create on Windows 10
7. Run taks in ***task scheduler** and verify that templates was downloaded to local folder
8. Log files will be created for each action and replace each run under path **C:\Users\Public\Documents**

```text

**********************
Windows PowerShell transcript start
Start time: 20210903001903
Username: AzureAD\MichalMachniak
RunAs User: AzureAD\MichalMachniak
Configuration Name: 
Machine: DESKTOP-FQQ6986 (Microsoft Windows NT 10.0.19041.0)
Host Application: C:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe -executionPolicy bypass -file C:\Program Files (x86)\Microsoft Intune Management Extension\Policies\Scripts\3a7dc62f-8b76-4e72-ab46-7ed2d7810eea_ce648ef6-e1f5-465d-b730-e71939ee35b4.ps1
Process ID: 7384
PSVersion: 5.1.19041.1151
PSEdition: Desktop
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.19041.1151
BuildVersion: 10.0.19041.1151
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
Transcript started, output file is C:\Users\Public\Documents\IntunePowerShell.log
-ExecutionPolicy Unrestricted -WindowStyle Hidden -NonInteractive -NoLogo "iex ((New-Object System.Net.WebClient).DownloadString('https://dofficetemplate.blob.core.windows.net/office-template/Intune-DocumentTemplateStorageAccount.ps1'))"

TaskPath                                       TaskName                          State
--------                                       --------                          -----
\                                              Intune Office Template            Ready
**********************
Windows PowerShell transcript end
End time: 20210903001904
**********************

```

```text

**********************
Windows PowerShell transcript start
Start time: 20210903203139
Username: AzureAD\MichalMachniak
RunAs User: AzureAD\MichalMachniak
Configuration Name: 
Machine: DESKTOP-FQQ6986 (Microsoft Windows NT 10.0.19041.0)
Host Application: C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe
Process ID: 5552
PSVersion: 5.1.19041.1151
PSEdition: Desktop
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.19041.1151
BuildVersion: 10.0.19041.1151
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
Transcript started, output file is C:\Users\Public\Documents\OfficeTemplates.log
PersonalTemplates reg exist in HKCU:\SOFTWARE\Microsoft\Office\16.0\Word\Options
PersonalTemplates reg exist in HKCU:\SOFTWARE\Microsoft\Office\16.0\PowerPoint\Options
PersonalTemplates reg exist in HKCU:\SOFTWARE\Microsoft\Office\16.0\Excel\Options
https://dofficetemplate.blob.core.windows.net/office-template/?comp=list
Location of file [C:\Users\MichalMachniak\OneDrive - sys4opshub\Documents\Office Templates\Demo-tempate -v2.dotx]
File downloaded [Demo-tempate -v2.dotx]
Location of file [C:\Users\MichalMachniak\OneDrive - sys4opshub\Documents\Office Templates\Demo-tempate.dotx]
File downloaded [Demo-tempate.dotx]
**********************
Windows PowerShell transcript end
End time: 20210903203140
**********************


```

